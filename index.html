<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krokat's Feral Sim (Turtle)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
</head>

<body>

    <div class="background-orb"></div>
    <div id="toast" class="toast">Action Successful!</div>

    <div id="progressOverlay" class="progress-overlay hidden">
        <div class="progress-box">
            <div id="progressText" class="progress-text">Loading...</div>
            <div class="progress-track"><div id="progressFill" class="progress-fill"></div></div>
        </div>
    </div>

    <div class="app-layout">
        
        <nav class="sidebar" id="sidebar"></nav>

        <main class="main-content">
            <div class="container">
                
                <header>
                    <div class="header-title-row">
                        <img src="Krokat.png" alt="Logo" class="header-logo">
                        <div>
                            <h1>Krokat's Feral Sim</h1>
                            <div class="subtitle">Turtle WoW Patch 1.17.2 | Cat DPS</div>
                        </div>
                    </div>
                    <div class="header-controls">
                        <div class="sim-name-wrapper">
                            <input type="text" id="simName" value="Feral Sim 1" onchange="updateSimName()">
                        </div>
                        <div class="header-btn-group">
                            <button class="icon-btn" onclick="exportSettings()" title="Export Link">üîó</button>
                            <button class="icon-btn" onclick="importFromClipboard()" title="Import Link">üì•</button>
                        </div>
                    </div>
                </header>

                <div id="itemSelectorModal" class="modal-overlay hidden">
                    <div class="modal-box">
                        <div class="modal-header"><span class="modal-title">Select Item</span><span class="modal-close" onclick="closeItemModal()">√ó</span></div>
                        <div class="modal-search"><input type="text" id="itemSearchInput" placeholder="Search item..." onkeyup="filterItemList()"></div>
                        <div class="modal-list" id="modalItemList"></div>
                    </div>
                </div>

                <div id="enchantSelectorModal" class="modal-overlay hidden">
                    <div class="modal-box small-modal">
                        <div class="modal-header"><span class="modal-title">Select Enchant</span><span class="modal-close" onclick="closeEnchantModal()">√ó</span></div>
                        <div class="modal-list" id="modalEnchantList"></div>
                    </div>
                </div>

                <div id="wowTooltip" class="wow-tooltip"></div>

                <div id="singleSimView">
                    
                    <div class="grid-container-custom">
                        
                        <div class="grid-col">
                            
                            <div class="card">
                                <div class="card-header clickable" onclick="toggleCard(this.querySelector('h2'))">
                                    <h2>üõ°Ô∏è Gear & Stats</h2>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                                <div class="card-body">
                                    <div class="char-sheet">
                                        <div class="char-left" id="charLeftCol"></div>
                                        
                                        <div class="char-middle">
                                            <div class="char-race-selector">
                                                <select id="char_race">
                                                    <option value="Tauren">Tauren</option>
                                                    <option value="NightElf">Night Elf</option>
                                                </select>
                                            </div>
                                            
                                            <div class="stat-weights-input-box">
                                                <h4>Stat Weights (Score)</h4>
                                                <div class="mini-grid">
                                                    <div><label>AP</label><input type="number" id="weight_ap" value="1.0"></div>
                                                    <div><label>Str</label><input type="number" id="weight_str" value="2.0"></div>
                                                    <div><label>Agi</label><input type="number" id="weight_agi" value="2.2"></div>
                                                    <div><label>Crit</label><input type="number" id="weight_crit" value="20.0"></div>
                                                    <div><label>Hit</label><input type="number" id="weight_hit" value="18.0"></div>
                                                    <div><label>Haste</label><input type="number" id="weight_haste" value="10.0"></div>
                                                </div>
                                            </div>

                                            <div style="text-align:center; margin-top:10px; font-size:0.7rem; color:#666;">
                                                <div id="dbStatus">DB Loading...</div>
                                            </div>
                                        </div>
                                        
                                        <div class="char-right" id="charRightCol"></div>
                                    </div>
                                    
                                    <div class="char-bottom" id="charBottomRow"></div>
                                    
                                    <hr class="separator">
                                    <h3>Current Stats (Buffed)</h3>
                                    <div class="stats-input-grid">
                                        <div class="input-wrapper"><label>Strength</label><input type="number" id="stat_str" disabled></div>
                                        <div class="input-wrapper"><label>Agility</label><input type="number" id="stat_agi" disabled></div>
                                        <div class="input-wrapper"><label>Intellect</label><input type="number" id="stat_int" disabled></div>
                                        
                                        <div class="input-wrapper"><label>Attack Power</label><input type="number" id="stat_ap" disabled></div>
                                        <div class="input-wrapper"><label>Crit Chance</label><input type="number" id="stat_crit" disabled></div>
                                        <div class="input-wrapper"><label>Hit Chance</label><input type="number" id="stat_hit" disabled></div>
                                        
                                        <div class="input-wrapper"><label>Haste</label><input type="number" id="stat_haste" disabled></div>
                                        <div class="input-wrapper"><label>Mana</label><input type="number" id="stat_mana" disabled></div>
                                        
                                        <div class="input-wrapper" style="display:flex; align-items:flex-end; justify-content:center;">
                                            <label class="toggle">
                                                <input type="checkbox" id="manual_stats">
                                                <span class="slider"></span>
                                                <span class="label-text" style="font-size:0.7rem;">Edit</span>
                                            </label>
                                        </div>
                                        <div class="input-wrapper hidden"><input type="number" id="stat_wps"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header clickable" onclick="toggleCard(this.querySelector('h2'))">
                                    <h2>‚ú® Buffs & Potions</h2>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                                <div class="card-body">
                                    <div class="buff-grid">
                                        <div class="buff-col">
                                            <h3>Class Buffs</h3>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_motw" checked><span class="checkmark"></span> MotW</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_bok" checked><span class="checkmark"></span> Kings</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_blessing_might" checked><span class="checkmark"></span> Might</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_trueshot"><span class="checkmark"></span> Trueshot</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_leader" checked><span class="checkmark"></span> LotP</label>
                                        </div>
                                        <div class="buff-col">
                                            <h3>Consumables</h3>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_food" checked><span class="checkmark"></span> Food (Str/Agi)</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_mongoose" checked><span class="checkmark"></span> Mongoose</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_juju_power"><span class="checkmark"></span> Juju Power</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_juju_might"><span class="checkmark"></span> Juju Might</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_giants"><span class="checkmark"></span> Giants</label>
                                        </div>
                                        <div class="buff-col">
                                            <h3>World / Scroll</h3>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_str_scroll"><span class="checkmark"></span> Scroll Str</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_agi_scroll"><span class="checkmark"></span> Scroll Agi</label>
                                            <label class="custom-checkbox"><input type="checkbox" id="buff_winterfall"><span class="checkmark"></span> Firewater</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div> <div class="grid-col">
                            
                            <div class="card">
                                <div class="card-header">
                                    <h2>‚öôÔ∏è General Settings</h2>
                                </div>
                                <div class="card-body">
                                    <div class="input-group">
                                        <label>Fight Duration (seconds)</label>
                                        <input type="number" id="maxTime" value="120">
                                    </div>
                                    <div class="input-group">
                                        <label>Sim Iterations</label>
                                        <input type="number" id="simCount" value="1000">
                                    </div>
                                    <div class="input-group hidden">
                                        <select id="calcMethod"><option value="S">Sim</option></select>
                                    </div>
                                    
                                    <hr class="separator">
                                    <h3>Target Properties</h3>
                                    <div class="input-group">
                                        <label>Target Level</label>
                                        <select id="enemy_level">
                                            <option value="63" selected>Level 63 (Boss)</option>
                                            <option value="60">Level 60</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>Armor</label>
                                        <input type="number" id="enemy_armor" value="3731">
                                    </div>
                                    <div class="stat-row-small" id="info_dr">DR: 0%</div>
                                    
                                    <div class="toggle-wrapper" style="margin-top:12px;">
                                        <label class="toggle">
                                            <input type="checkbox" id="enemy_can_bleed" checked>
                                            <span class="slider"></span>
                                            <span class="label-text">Can Bleed</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="cat-visual-card">
                                <div class="cat-image-placeholder" style="background-image: url('https://wow.zamimg.com/uploads/screenshots/normal/119207-cat-form-night-elf.jpg');"></div>
                                <div class="cat-overlay-text">FERAL DRUID</div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h2>‚öîÔ∏è Rotation Strategy</h2>
                                </div>
                                <div class="card-body">
                                    <div class="toggle-grid">
                                        <label class="toggle">
                                            <input type="checkbox" id="pos_behind" checked>
                                            <span class="slider"></span>
                                            <span class="label-text">Position: Behind (Use Shred)</span>
                                        </label>

                                        <label class="toggle">
                                            <input type="checkbox" id="use_rake" checked>
                                            <span class="slider"></span>
                                            <span class="label-text">Use Rake (Maintain Bleed)</span>
                                        </label>

                                        <label class="toggle">
                                            <input type="checkbox" id="use_bite" checked>
                                            <span class="slider"></span>
                                            <span class="label-text">Use Ferocious Bite (at 5 CP)</span>
                                        </label>

                                        <hr class="separator" style="margin: 8px 0;">

                                        <label class="toggle">
                                            <input type="checkbox" id="use_powershift" checked>
                                            <span class="slider"></span>
                                            <span class="label-text">Use Powershifting</span>
                                        </label>

                                        <label class="toggle">
                                            <input type="checkbox" id="aggressive_shift">
                                            <span class="slider"></span>
                                            <span class="label-text">Aggressive Shift (Ignore Ticks)</span>
                                        </label>
                                    </div>

                                    <div class="input-group" style="margin-top:15px;">
                                        <label>Shift Energy Refund (Talent + Wolfshead)</label>
                                        <input type="number" id="energy_refund_chance" value="60">
                                    </div>
                                </div>
                            </div>

                        </div> </div> <div class="action-bar">
                        <button class="run-btn" onclick="runSimulation()">
                            <span class="run-icon">‚öîÔ∏è</span> RUN SIMULATION
                        </button>
                        
                        <button class="weight-btn" onclick="runStatWeights()">
                            ‚öñÔ∏è STAT WEIGHTS
                        </button>
                    </div>


                    <div id="resultsArea">
                        <div class="card full-width">
                            <div class="card-header">
                                <h2>üìà Simulation Results</h2>
                                <div class="view-controls">
                                    <button class="view-btn active" id="viewAvg" onclick="switchView('avg')">Average</button>
                                    <button class="view-btn" id="viewMin" onclick="switchView('min')">Min</button>
                                    <button class="view-btn" id="viewMax" onclick="switchView('max')">Max</button>
                                </div>
                            </div>
                            <div class="card-body">
                                
                                <div class="result-highlight-grid">
                                    <div class="res-box">
                                        <span class="res-label">DPS</span>
                                        <span class="res-val big" id="out_dps_main">-</span>
                                    </div>
                                    <div class="res-box">
                                        <span class="res-label">Total Damage</span>
                                        <span class="res-val" id="out_total_dmg">-</span>
                                    </div>
                                    <div class="res-box">
                                        <span class="res-label">Powershifts</span>
                                        <span class="res-val" id="out_shifts">-</span>
                                    </div>
                                    <div class="res-box">
                                        <span class="res-label">Wasted CP</span>
                                        <span class="res-val" id="out_cp_waste">-</span>
                                    </div>
                                </div>

                                <div class="weights-result-box">
                                    <h3>Calculated Stat Weights (EP Values)</h3>
                                    <div class="weights-grid-display">
                                        <div class="w-item"><span>AP</span><span class="w-val" id="res_weight_ap">-</span></div>
                                        <div class="w-item"><span>Str</span><span class="w-val" id="res_weight_str">-</span></div>
                                        <div class="w-item"><span>Agi</span><span class="w-val" id="res_weight_agi">-</span></div>
                                        <div class="w-item"><span>Crit</span><span class="w-val" id="res_weight_crit">-</span></div>
                                        <div class="w-item"><span>Hit</span><span class="w-val" id="res_weight_hit">-</span></div>
                                        <div class="w-item"><span>Haste</span><span class="w-val" id="res_weight_haste">-</span></div>
                                    </div>
                                </div>

                                <div class="table-container">
                                    <table class="result-table">
                                        <thead>
                                            <tr>
                                                <th class="text-left">Ability</th>
                                                <th class="text-right">Damage</th>
                                                <th class="text-right">%</th>
                                                <th class="bar-col">Share</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbl_body">
                                            <tr><td colspan="4" class="text-center muted">No simulation run yet.</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="log-controls">
                                    <h3>Combat Log (Detailed)</h3>
                                </div>
                                <div class="log-container">
                                    <table class="log-table">
                                        <thead>
                                            <tr>
                                                <th style="width:60px;">Time</th>
                                                <th>Source</th>
                                                <th>Event</th>
                                                <th>Result</th>
                                                <th class="text-right">Amt</th>
                                                <th class="text-center">Energy</th>
                                                <th class="text-center">CP</th>
                                                <th class="text-center">Mana</th>
                                                <th class="text-left">Info</th>
                                            </tr>
                                        </thead>
                                        <tbody id="logBody">
                                            <tr><td colspan="9" class="text-center muted">No log available.</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

                <div id="comparisonView" class="hidden"></div>
                
            </div>
        </main>
    </div>

    <script src="js/01_globals.js"></script>
    <script src="js/02_utils.js"></script>
    <script src="js/03_gear.js"></script>
    <script src="js/04_ui.js"></script>
    <script src="js/05_engine.js"></script>
    <script src="js/06_main.js"></script>
</body>
</html>