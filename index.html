<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krokat's Feral Sim (Turtle WoW)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.ico">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
</head>

<body>

    <div class="background-orb" style="background: radial-gradient(circle, rgba(255, 69, 0, 0.15) 0%, rgba(18, 18, 18, 0) 70%);"></div>
    <div id="toast" class="toast">Action Successful!</div>

    <div id="progressOverlay" class="progress-overlay hidden">
        <div class="progress-box">
            <div id="progressText" class="progress-text">Loading...</div>
            <div class="progress-track">
                <div id="progressFill" class="progress-fill"></div>
            </div>
        </div>
    </div>

    <div class="app-layout">
        <nav class="sidebar" id="sidebar"></nav>

        <main class="main-content">
            <div class="container">

                <header>
                    <div class="header-title-row">
                        <img src="Krokat.png" alt="Krokat" class="header-avatar">
                        <h1>Krokat's Catsim</h1>
                    </div>
                    <input type="text" id="simName" class="sim-name-input" value="Simulation 1"
                        onchange="updateSimName()">
                    <div class="header-actions">
                        <button onclick="importFromClipboard()" class="share-btn" style="margin-right: 5px;">üì•
                            Import</button>
                        <button onclick="exportSettings()" class="share-btn">üîó Share / Save Config</button>
                    </div>
                </header>

                <div id="itemSelectorModal" class="modal-overlay hidden" onclick="if(event.target === this) closeItemModal()">
                    <div class="modal-box">
                        <div class="modal-header">
                            <span class="modal-title" id="modalTitle">Select Item</span>
                            <span class="modal-close" onclick="closeItemModal()">√ó</span>
                        </div>
                        <div class="modal-search">
                            <input type="text" id="itemSearchInput" placeholder="Search item..."
                                onkeyup="filterItemList()">
                        </div>
                        <div class="modal-list" id="modalItemList"></div>
                    </div>
                </div>

                <div id="enchantSelectorModal" class="modal-overlay hidden" onclick="if(event.target === this) closeEnchantModal()">
                    <div class="modal-box">
                        <div class="modal-header">
                            <span class="modal-title" id="enchantModalTitle">Select Enchant</span>
                            <span class="modal-close" onclick="closeEnchantModal()">√ó</span>
                        </div>
                        <div class="modal-list" id="modalEnchantList"></div>
                    </div>
                </div>

                <div id="wowTooltip" class="wow-tooltip"></div>

                <div id="simulationViewWrapper">
                    
                    <div id="comparisonView" class="hidden">
                        <div class="card full-width">
                            <div class="card-header">
                                <h2>‚öîÔ∏è Simulation Comparison</h2>
                                <button onclick="runAllSims()" class="btn-mini primary-btn">Run All</button>
                            </div>
                            <div class="card-body">
                                <div class="comparison-container">
                                    <table class="comp-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Dur</th>
                                                <th>Iter</th>
                                                <th>AP</th>
                                                <th>Crit</th>
                                                <th>Hit</th>
                                                <th>Haste</th>
                                                <th>Boss Lvl</th>
                                                <th>Rotation</th>
                                                <th>Gear / Sets</th>
                                                <th style="color:#90caf9; text-align:right;">Min DPS</th>
                                                <th style="color:#ffb74d; text-align:right;">Avg DPS</th>
                                                <th style="color:#a5d6a7; text-align:right;">Max DPS</th>
                                                <th style="text-align:center;">Del</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comparisonBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="singleSimView">
                        <div class="grid-container">
                            
                            <div class="card full-width">
                                <div class="card-header clickable" onclick="toggleCard(this)">
                                    <h2>üõ°Ô∏è Equipment Planner</h2>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                                <div class="card-body">
                                    <div class="char-sheet" style="margin-bottom: 0;">
                                        <div class="char-left" id="charLeftCol"></div>

                                        <div class="char-middle">
                                            <h2 style="margin-bottom:10px; font-size:1rem;">Stat Weights (EP Calc)</h2>
                                            <div class="gp-two-col">
                                                <div class="gp-input-group"><label>Str</label><input type="number" id="weight_str" value="2.4" onchange="recalcItemScores()"></div>
                                                <div class="gp-input-group"><label>Agi</label><input type="number" id="weight_agi" value="2.5" onchange="recalcItemScores()"></div>
                                                <div class="gp-input-group"><label>AP</label><input type="number" id="weight_ap" value="1.0" onchange="recalcItemScores()"></div>
                                                <div class="gp-input-group"><label>Crit</label><input type="number" id="weight_crit" value="22.0" onchange="recalcItemScores()"></div>
                                                <div class="gp-input-group"><label>Hit</label><input type="number" id="weight_hit" value="18.0" onchange="recalcItemScores()"></div>
                                            </div>

                                            <h2 style="margin:20px 0 10px 0; font-size:1rem;">Current Gear Stats</h2>
                                            <div class="gp-stats-preview">
                                                <div style="background: rgba(255, 69, 0, 0.15); border: 1px solid var(--druid-orange); padding: 10px 20px; border-radius: 8px; text-align: center; width: 100%;">
                                                    <div style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted);">Gear Score</div>
                                                    <div id="gp_gs" style="font-size: 2rem; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 125, 10, 0.5);">0</div>
                                                </div>
                                                <div class="gp-stat-grid">
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">Str</div><div id="gp_str" style="font-size:1rem; color:#fff;">0</div></div>
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">Agi</div><div id="gp_agi" style="font-size:1rem; color:#fff;">0</div></div>
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">AP</div><div id="gp_ap" style="font-size:1rem; color:#ff9800;">0</div></div>
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">Crit</div><div id="gp_crit" style="font-size:1rem; color:#ffeb3b;">0%</div></div>
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">Hit</div><div id="gp_hit" style="font-size:1rem; color:#fff;">0%</div></div>
                                                    <div class="gp-stat-box"><div style="font-size:0.75rem; color:#aaa;">Haste</div><div id="gp_haste" style="font-size:1rem; color:#fff;">0%</div></div>
                                                </div>
                                            </div>

                                            <div style="margin-top:20px; width:100%;">
                                                <button onclick="resetGear()" class="btn-mini" style="background:#333; width:100%;">Reset Gear</button>
                                            </div>
                                            <div id="dbStatus" style="font-size:0.65rem; color:#666; margin-top:10px;">DB not loaded</div>
                                            <div class="char-bottom" id="charBottomRow"></div>
                                        </div>
                                        <div class="char-right" id="charRightCol"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="card full-width">
                                <div class="card-header clickable" onclick="toggleCard(this)">
                                    <h2>‚öôÔ∏è Settings & Configuration</h2>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                                <div class="card-body">
                                    <div class="grid-container" style="margin:0; padding:0;">

                                        <div class="card full-width">
                                            <div class="card-header clickable" onclick="toggleCard(this)">
                                                <h2>‚ú® Buffs & Consumables</h2>
                                                <span class="toggle-icon">‚ñº</span>
                                            </div>
                                            <div class="card-body">
                                                <div class="buff-grid">
                                                    <div>
                                                        <div class="gear-section-title" style="margin-top:0;">Consumables</div>
                                                        <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_elemental" class="mut-ex-wep"><span class="checkmark"></span> Elemental Sharpening Stone (2% Crit)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_consecrated" class="mut-ex-wep"><span class="checkmark"></span> Consecrated Sharpening Stone (100 AP vs Undead)</label>
                                                            
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_mongoose" checked><span class="checkmark"></span> Elixir of the Mongoose</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_potion_quickness"><span class="checkmark"></span> Potion of Quickness (5% Haste)</label>
                                                            
                                                            <div style="margin-top:10px; font-size:0.85rem; color:#666;">Food</div>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_food_str" class="mut-ex-food" checked><span class="checkmark"></span> Smoked Dumplings / Mushroom (20 Str)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_food_agi" class="mut-ex-food"><span class="checkmark"></span> Sour Mountain Berry (10 Agi)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_food_haste" class="mut-ex-food"><span class="checkmark"></span> Tel'abim Medley (2% Haste)</label>
                                                            
                                                            <div style="margin-top:10px; font-size:0.85rem; color:#666;">Blasted Lands</div>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_scorpok" class="mut-ex-bl" checked><span class="checkmark"></span> Scorpok Assay (25 Agi)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_roids" class="mut-ex-bl"><span class="checkmark"></span> R.O.I.D.S (25 Str)</label>

                                                            <div style="margin-top:10px; font-size:0.85rem; color:#666;">Jujus / Firewater</div>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_juju_might" class="mut-ex-juju" checked><span class="checkmark"></span> Juju Might (40 AP)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_firewater" class="mut-ex-juju"><span class="checkmark"></span> Winterfall Firewater (35 AP)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="consum_juju_power" checked><span class="checkmark"></span> Juju Power (30 Str)</label>
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <div class="gear-section-title" style="margin-top:0;">Raid Buffs</div>
                                                        <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_motw" checked><span class="checkmark"></span> Mark of the Wild (Imp)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_kings" checked><span class="checkmark"></span> Blessing of Kings</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_might" checked><span class="checkmark"></span> Blessing of Might (Imp)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_bs" checked><span class="checkmark"></span> Battle Shout (Imp)</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_lotp" checked><span class="checkmark"></span> Leader of the Pack</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_tsa" checked><span class="checkmark"></span> Trueshot Aura</label>
                                                            
                                                            <div style="margin-top:10px; font-size:0.85rem; color:#666;">Totems</div>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_wf_totem" checked><span class="checkmark"></span> Windfury Totem</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_goa_totem" checked><span class="checkmark"></span> Grace of Air</label>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_soe_totem" checked><span class="checkmark"></span> Strength of Earth</label>

                                                            <div style="margin-top:10px; font-size:0.85rem; color:#666;">World Buffs</div>
                                                            <label class="custom-checkbox"><input type="checkbox" id="buff_warchief" checked><span class="checkmark"></span> Warchief's Blessing</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">
                                                <h2>‚öôÔ∏è General</h2>
                                            </div>
                                            <div class="card-body">
                                                <div class="input-group"><label>Fight Duration (s)</label><input type="number" id="simTime" value="60"></div>
                                                <div class="input-group"><label>Iterations</label><input type="number" id="simCount" value="1000"></div>
                                            </div>
                                        </div>

                                        <div class="card full-width-mobile">
                                            <div class="card-header">
                                                <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                                                    <h2>üìä Player Stats (Active)</h2>
                                                    <label class="toggle" style="transform: scale(0.7); margin:0;">
                                                        <input type="checkbox" id="manual_stats">
                                                        <span class="slider"></span>
                                                    </label>
                                                    <span style="font-size:0.7em; color:#888; margin-left:-5px;">Manual</span>
                                                </div>
                                            </div>

                                            <div class="card-body">
                                                <div class="input-group">
                                                    <label>Race</label>
                                                    <div class="select-wrapper">
                                                        <select id="char_race">
                                                            <option value="Tauren">Tauren</option>
                                                            <option value="NightElf">Night Elf</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="spell-row">
                                                    <div class="multi-input">
                                                        <div class="input-wrapper"><label>Str</label><input type="number" id="stat_str" disabled></div>
                                                        <div class="input-wrapper"><label>Agi</label><input type="number" id="stat_agi" disabled></div>
                                                        <div class="input-wrapper"><label>AP</label><input type="number" id="stat_ap" disabled></div>
                                                    </div>
                                                </div>
                                                <div class="spell-row" style="margin-top:10px;">
                                                    <div class="multi-input">
                                                        <div class="input-wrapper"><label>Crit %</label><input type="number" id="stat_crit" disabled></div>
                                                        <div class="input-wrapper"><label>Hit %</label><input type="number" id="stat_hit" disabled></div>
                                                        <div class="input-wrapper"><label>Haste %</label><input type="number" id="stat_haste" disabled></div>
                                                    </div>
                                                </div>
                                                <input type="hidden" id="mana_pool" value="3000"> <input type="hidden" id="stat_wep_dmg_min" value="55">
                                                <input type="hidden" id="stat_wep_dmg_max" value="85">
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">
                                                <h2>üåø Talente</h2>
                                            </div>
                                            <div class="card-body">
                                                <p style="font-size:0.8rem; color:#888; margin-bottom:15px;">Only optional talents listed. Others assumed constant.</p>
                                                <div class="input-group-small">
                                                    <label>Ferocity</label>
                                                    <div class="select-wrapper">
                                                        <select id="tal_ferocity">
                                                            <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="input-group-small" style="margin-top:10px;">
                                                    <label>Feral Aggression</label>
                                                    <div class="select-wrapper">
                                                        <select id="tal_feral_aggression">
                                                            <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="input-group-small" style="margin-top:10px;">
                                                    <label>Imp. Shred</label>
                                                    <div class="select-wrapper">
                                                        <select id="tal_imp_shred">
                                                            <option value="0">0</option><option value="1">1</option><option value="2" selected>2</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="input-group-small" style="margin-top:10px;">
                                                    <label>Nat. Shapeshifter</label>
                                                    <div class="select-wrapper">
                                                        <select id="tal_nat_shapeshifter">
                                                            <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <input type="hidden" id="tal_berserk" value="1">
                                            </div>
                                        </div>

                                        <div class="card">
                                            <div class="card-header">
                                                <h2>üíÄ Enemy</h2>
                                            </div>
                                            <div class="card-body">
                                                <div class="input-group"><label>Select Boss (Sets Armor)</label><div class="select-wrapper"><select id="enemy_boss_select"><option value="">-- Custom / Manual --</option></select></div></div>
                                                
                                                <div class="input-group"><label>Target Level</label><div class="select-wrapper"><select id="enemy_level"><option value="63" selected>Level 63 (Boss)</option><option value="60">Level 60</option></select></div></div>
                                                <div class="input-group"><label>Enemy Type</label><div class="select-wrapper"><select id="enemy_type"><option value="undead">Undead</option><option value="humanoid" selected>Humanoid / Other</option></select></div></div>
                                                <div class="input-group"><label>Base Armor</label><input type="number" id="enemy_armor" value="3731"></div>
                                                <div class="toggle-wrapper" style="margin-top:10px;">
                                                    <label class="toggle"><input type="checkbox" id="enemy_can_bleed" checked><span class="slider"></span><span class="label-text">Can Bleed</span></label>
                                                </div>
                                                
                                                <div class="gear-section-title">Debuffs (Armor)</div>
                                                <div class="input-group"><label>Major Armor Reduct</label><div class="select-wrapper"><select id="debuff_major_armor"><option value="">None</option><option value="sunder" selected>Sunder Armor x5 (-2250)</option><option value="iea">Imp. Exposed Armor (-2550)</option></select></div></div>
                                                <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                                                    <label class="custom-checkbox"><input type="checkbox" id="debuff_eskhandar"><span class="checkmark"></span> Spirit of Eskhandar (-1200)</label>
                                                    <label class="custom-checkbox"><input type="checkbox" id="debuff_ff" checked><span class="checkmark"></span> Faerie Fire (-505)</label>
                                                    <label class="custom-checkbox"><input type="checkbox" id="debuff_cor" checked><span class="checkmark"></span> Curse of Recklessness (-640)</label>
                                                </div>

                                                <div class="enemy-info-box" style="margin-top:15px;">
                                                    <div style="font-size:0.85rem; color:#aaa; margin-bottom:5px;">Damage Reduction (Armor)</div>
                                                    <div class="enemy-bar-container">
                                                        <div id="enemyArmorBar" class="enemy-bar-fill" style="width: 0%;"></div>
                                                        <div id="enemyArmorText" class="enemy-bar-text">0%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card full-width">
                                            <div class="card-header">
                                                <h2>üîÑ Rotation Priority</h2>
                                            </div>
                                            <div class="card-body">
                                                <div class="input-group" style="margin-bottom:20px;">
                                                    <label>Positioning</label>
                                                    <div class="select-wrapper"><select id="rota_position"><option value="back">Behind (Shred)</option><option value="front">Front (Claw)</option></select></div>
                                                </div>
                                                
                                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; background:#252525; padding:8px; border-radius:6px;">
                                                    <label class="toggle" style="margin:0;"><input type="checkbox" id="use_rip" checked><span class="slider"></span><span class="label-text" style="color:var(--druid-orange)">Use Rip</span></label>
                                                    <div style="display:flex; align-items:center; gap:8px;"><label style="font-size:0.85rem; color:#aaa;">Min CP:</label><input type="number" id="rip_cp" value="5" min="1" max="5" style="width:60px; padding:4px;"></div>
                                                </div>

                                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; background:#252525; padding:8px; border-radius:6px;">
                                                    <label class="toggle" style="margin:0;"><input type="checkbox" id="use_fb" checked><span class="slider"></span><span class="label-text" style="color:var(--druid-orange)">Use Bite</span></label>
                                                    <div style="display:flex; align-items:center; gap:8px;"><label style="font-size:0.85rem; color:#aaa;">Min Energy:</label><input type="number" id="fb_energy" value="35" min="35" max="100" style="width:60px; padding:4px;"></div>
                                                </div>

                                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; background:#252525; padding:8px; border-radius:6px;">
                                                    <label class="toggle" style="margin:0;"><input type="checkbox" id="use_reshift" checked><span class="slider"></span><span class="label-text" style="color:var(--druid-orange)">Powershift</span></label>
                                                    <div style="display:flex; align-items:center; gap:8px;"><label style="font-size:0.85rem; color:#aaa;">Max Energy:</label><input type="number" id="reshift_energy" value="10" min="0" max="100" style="width:60px; padding:4px;"></div>
                                                </div>

                                                <div class="separator"></div>
                                                <div class="toggle-grid">
                                                    <label class="toggle"><input type="checkbox" id="use_tf" checked><span class="slider"></span><span class="label-text">Tiger's Fury</span></label>
                                                    <label class="toggle"><input type="checkbox" id="use_rake" checked><span class="slider"></span><span class="label-text">Use Rake</span></label>
                                                    <label class="toggle"><input type="checkbox" id="use_shred" checked><span class="slider"></span><span class="label-text">Use Shred</span></label>
                                                    <label class="toggle"><input type="checkbox" id="use_claw"><span class="slider"></span><span class="label-text">Use Claw</span></label>
                                                    <label class="toggle"><input type="checkbox" id="use_ff" checked><span class="slider"></span><span class="label-text">Faerie Fire</span></label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="card full-width">
                                <div class="card-header clickable" onclick="toggleCard(this)">
                                    <h2>üõ°Ô∏è Special Gear / Sets</h2>
                                    <span class="toggle-icon">‚ñº</span>
                                </div>
                                <div class="card-body">
                                    <div class="checkbox-grid">
                                        <label class="custom-checkbox"><input type="checkbox" id="meta_wolfshead" disabled><span class="checkmark"></span> Wolfshead Helm (Energy)</label>
                                        <label class="custom-checkbox"><input type="checkbox" id="set_t05_4p" disabled><span class="checkmark"></span> T0.5 4p (Energy Proc)</label>
                                        <label class="custom-checkbox"><input type="checkbox" id="item_mcp" disabled><span class="checkmark"></span> Manual Crowd Pummeler</label>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="action-area-wrapper" style="display:flex; flex-direction:column; align-items:center; gap:10px; margin: 20px 0;">
                            <div class="button-row" style="display:flex; gap:15px;">
                                <button id="btnRun" class="primary-btn"><span class="btn-icon">‚ö°</span> Run Simulation</button>
                            </div>
                        </div>

                        <div id="simResultsArea" class="card full-width hidden">
                            <div class="card-header clickable" onclick="toggleCard(this)">
                                <h2>üìà Simulation Results</h2>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div class="card-body">
                                <div class="results-header" style="border-bottom:none; margin-bottom:10px;">
                                    <div class="center-toggles">
                                        </div>
                                    <div class="right-actions"><button onclick="generateSummaryImage()" class="btn-mini">üì∏ Save Image</button></div>
                                </div>

                                <div class="stats-grid">
                                    <div class="stat-box primary">
                                        <h3>DPS</h3><span id="resDps" class="big-number">0</span>
                                    </div>
                                    <div class="stat-box">
                                        <h3>Total Damage</h3><span id="resTotalDmg" class="med-number">0</span>
                                    </div>
                                    <div class="stat-box">
                                        <h3>Duration</h3><span id="resDuration" class="med-number">0s</span>
                                    </div>
                                    <div class="stat-box">
                                        <h3>Shifts</h3><span id="resMana" class="med-number" style="color:#81d4fa;">0</span>
                                    </div>
                                </div>

                                <div class="table-wrapper" style="margin-top:20px;">
                                    <div id="dmgDistBar" style="height:5px; width:100%; display:flex; margin-bottom:10px; border-radius:3px; overflow:hidden;"></div>
                                    <table class="result-table">
                                        <thead>
                                            <tr>
                                                <th class="text-left">Ability</th>
                                                <th class="text-right">Total Dmg</th>
                                                <th class="text-right">DPS</th>
                                                <th class="text-right">%</th>
                                                <th class="text-right">Count</th>
                                                <th class="text-right">Crit %</th>
                                                <th class="text-right">Glance %</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resTableBody"></tbody>
                                    </table>
                                </div>

                                <div id="combatLogSection" style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
                                    <div class="results-header">
                                        <h2>üìú Combat Log</h2>
                                        <div class="log-actions">
                                            <button class="btn-mini" onclick="prevLogPage()"> < </button>
                                            <span id="logPageLabel" style="font-size:0.8rem; padding:5px;">Page 1</span>
                                            <button class="btn-mini" onclick="nextLogPage()"> > </button>
                                            <button onclick="downloadCSV()" class="btn-mini">üíæ CSV</button>
                                        </div>
                                    </div>
                                    <div class="log-container">
                                        <table class="log-table">
                                            <thead>
                                                <tr><th>Time</th><th>Event</th><th>Ability</th><th>Result</th><th>Dmg</th><th>Info</th></tr>
                                            </thead>
                                            <tbody id="logTableBody"></tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="summaryCard" class="summary-card">
        <div class="summary-header">
            <div class="summary-branding">
                <div class="sum-avatar" style="background:#ff7d0a; display:flex; align-items:center; justify-content:center;">üêæ</div>
                <div>
                    <div class="summary-title">Feral Sim</div>
                    <div class="summary-sim-name" id="sumSimName">Sim Name</div>
                </div>
            </div>
            <div class="summary-meta">
                <div id="sumDate">Date</div>
                <div>Krokat's Feral 1.18</div>
            </div>
        </div>
        <div class="summary-hero-row">
            <div class="hero-box">
                <div class="hero-label">Average DPS</div>
                <div class="hero-val text-orange" id="sumAvg">0.0</div>
            </div>
            <div class="hero-box">
                <div class="hero-label">Duration</div>
                <div class="hero-val" id="sumTime">60s</div>
            </div>
        </div>
        <div class="summary-grid">
            <div class="sum-col">
                <div class="sum-sec-title">Player Stats</div>
                <div class="sum-row"><span>AP</span> <span id="sumAP">0</span></div>
                <div class="sum-row"><span>Crit</span> <span id="sumCrit">0%</span></div>
                <div class="sum-row"><span>Hit</span> <span id="sumHit">0%</span></div>
                <div class="sum-row"><span>Haste</span> <span id="sumHaste">0%</span></div>
            </div>
            <div class="sum-col">
                <div class="sum-sec-title">Rotation</div>
                <ul class="sum-list" id="sumRotaList"></ul>
            </div>
            <div class="sum-col">
                <div class="sum-sec-title">Trinkets / Idols</div>
                <ul class="sum-list" id="sumTrinketList"></ul>
            </div>
        </div>
        <div class="summary-footer">Turtle WoW Feral Simulator</div>
    </div>

    <script src="js/01_globals.js"></script>
    <script src="js/02_utils.js"></script>
    <script src="js/03_gear.js"></script>
    <script src="js/04_ui.js"></script>
    <script src="js/05_engine.js"></script>
    <script src="js/06_main.js"></script>

    <script>
        function generateSummaryImage() {
            var card = document.getElementById("summaryCard");
            var resDps = document.getElementById("resDps").innerText;
            var simTime = document.getElementById("simTime").value;
            var simName = document.getElementById("simName").value;
            
            document.getElementById("sumAvg").innerText = resDps;
            document.getElementById("sumTime").innerText = simTime + "s";
            document.getElementById("sumSimName").innerText = simName;
            document.getElementById("sumDate").innerText = new Date().toLocaleDateString();

            card.style.position = "fixed";
            card.style.top = "0";
            card.style.zIndex = "9999";
            
            html2canvas(card, {backgroundColor: "#121212"}).then(canvas => {
                var link = document.createElement('a');
                link.download = 'feral_sim_summary.png';
                link.href = canvas.toDataURL();
                link.click();
                
                card.style.top = "-2000px";
            });
        }
    </script>
</body>
</html>