<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krokat's Feral Sim v0.01</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.ico"> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
</head>

<body>

    <div class="background-overlay"></div>
    <div id="toast" class="toast">Action Successful!</div>

    <div class="main-container">
        
        <div class="header">
            <h1>Krokat's Feralsim<span>-</span></h1>
            <div class="sim-controls">
                <button id="btnRun" onclick="startSim()">Run Simulation</button>
                <button class="secondary" onclick="exportSettings()">Export</button>
                <button class="secondary" onclick="importSettings()">Import</button>
            </div>
        </div>

        <div class="content-grid">
            
            <div class="col-settings">
                
                <div class="card">
                    <div class="card-title">Simulation Settings</div>
                    <div class="input-group">
                        <label>Duration (sec)</label>
                        <input type="number" id="simTime" value="60">
                    </div>
                    <div class="input-group">
                        <label>Iterations</label>
                        <input type="number" id="simIter" value="1000">
                    </div>
                    <div class="input-group">
                        <label>Enemy Level</label>
                        <select id="enemy_level">
                            <option value="60">60</option>
                            <option value="61">61</option>
                            <option value="62">62</option>
                            <option value="63" selected>63 (Boss)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Enemy Armor</label>
                        <input type="number" id="enemy_armor" value="3731" title="3731 is standard Boss armor (after Sunder/Faerie)">
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">
                        Character Stats (Unbuffed)
                        <span style="font-size:0.8em; font-weight:normal; float:right;">
                            <input type="checkbox" id="manual_stats"> Manual Override
                        </span>
                    </div>
                    <div class="stats-grid">
                        <div class="input-group">
                            <label>Strength</label>
                            <input type="number" id="stat_strength" value="150">
                        </div>
                        <div class="input-group">
                            <label>Agility</label>
                            <input type="number" id="stat_agility" value="250">
                        </div>
                        <div class="input-group">
                            <label>Attack Power</label>
                            <input type="number" id="stat_ap" value="800">
                        </div>
                        <div class="input-group">
                            <label>Crit %</label>
                            <input type="number" id="stat_crit" value="25.0" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Hit %</label>
                            <input type="number" id="stat_hit" value="5.0" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Haste %</label>
                            <input type="number" id="stat_haste" value="0" step="1">
                        </div>
                        <div class="input-group">
                            <label>Weapon DPS</label>
                            <input type="number" id="weapon_dps" value="55.0" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Weapon Speed</label>
                            <input type="number" id="weapon_speed" value="2.0" step="0.1">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Talents & Mechanics</div>
                    <div class="checkbox-list">
                        <label><input type="checkbox" id="talent_furor" checked> Furor (5/5)</label>
                        <label><input type="checkbox" id="talent_open_wounds" checked> Open Wounds (Rake buffs Claw)</label>
                        <label><input type="checkbox" id="talent_imp_shred" checked> Imp. Shred (-Cost)</label>
                        <label><input type="checkbox" id="talent_omen" checked> Omen of Clarity</label>
                        <hr>
                        <label><input type="checkbox" id="meta_wolfshead" checked> Wolfshead Effect (Item/Enchant)</label>
                        <label><input type="checkbox" id="meta_reshift" checked> Use Reshift / Powershift</label>
                    </div>
                </div>
            </div>

            <div class="col-middle">
                
                <div class="card">
                    <div class="card-title">Rotation Priority</div>
                    <div class="input-group">
                        <label>Finisher Mode</label>
                        <select id="finisher_mode">
                            <option value="smart">Smart (Rip if high HP)</option>
                            <option value="bite" selected>Aggressive (Always Bite)</option>
                            <option value="rip">DoT Focus (Always Rip)</option>
                        </select>
                    </div>
                    <div class="checkbox-list">
                        <label><input type="checkbox" id="conf_use_rake" checked> Maintain Rake (Crucial for OW)</label>
                        <label><input type="checkbox" id="conf_use_tigersfury"> Use Tiger's Fury</label>
                        <label><input type="checkbox" id="use_shred" checked> Use Shred (Positioned Behind)</label>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Buffs & Consumables</div>
                    <div class="buff-grid">
                        <label><input type="checkbox" id="buff_motw" checked> Mark of the Wild</label>
                        <label><input type="checkbox" id="buff_kings" checked> Blessing of Kings</label>
                        <label><input type="checkbox" id="buff_might" checked> Blessing of Might</label>
                        <label><input type="checkbox" id="buff_horn"> Horn of Winter</label>
                        <label><input type="checkbox" id="buff_mongoose" checked> Elixir of Mongoose</label>
                        <label><input type="checkbox" id="buff_giants"> Elixir of Giants</label>
                        <label><input type="checkbox" id="buff_juju_power"> Juju Power (Str)</label>
                        <label><input type="checkbox" id="buff_juju_might"> Juju Might (AP)</label>
                        <label><input type="checkbox" id="buff_dumpling" checked> Smoked Desert Dumplings</label>
                        <label><input type="checkbox" id="buff_scorpok"> R.O.I.D.S (Scorpok)</label>
                        <label><input type="checkbox" id="buff_elemental_stone"> Ele Sharp Stone (Crit)</label>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Equipped Gear</div>
                    <div id="gearListContainer" class="gear-list-small">
                        <div style="font-size:0.8em; color:var(--text-muted); text-align:center;">
                            Load items via JS to populate this list.
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-results">
                <div class="card sticky-card">
                    <div class="card-title">Simulation Results</div>
                    
                    <div class="dps-display">
                        <span id="resultDPS">0</span>
                        <small>DPS</small>
                    </div>

                    <div class="resource-viz">
                        <div class="energy-bar-bg">
                            <div id="vizEnergy" class="energy-bar-fill" style="width: 100%;"></div>
                            <span id="vizEnergyText">100 / 100</span>
                        </div>
                        <div id="vizCombo" class="combo-container">
                            <div class="cp"></div><div class="cp"></div><div class="cp"></div><div class="cp"></div><div class="cp"></div>
                        </div>
                    </div>

                    <div class="result-summary">
                        <div class="row"><span>Total Damage:</span> <span id="resultTotal">0</span></div>
                        <div class="row"><span>Duration:</span> <span id="resultDur">0s</span></div>
                        <hr>
                        <div class="row"><span>Crit Rate (Obs):</span> <span id="resultCrit">0%</span></div>
                        <div class="row"><span>Hit Rate (Obs):</span> <span id="resultHit">0%</span></div>
                    </div>

                    <div class="card-title" style="margin-top:20px;">Damage Breakdown</div>
                    <div id="dpsBreakdown" class="dps-breakdown">
                        </div>
                </div>
            </div>

        </div>
    </div>

    <script src="js/01_globals.js"></script>
    <script src="js/02_utils.js"></script>
    <script src="js/03_gear.js"></script>
    <script src="js/04_ui.js"></script>
    <script src="js/05_engine.js"></script>
    <script src="js/06_main.js"></script>
</body>
</html>